// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Aquí abajo se definirían los 'modelos' que relacionan tablas de la BD con objetos de JS
model Person {
  id             Int       @id @default(autoincrement())
  firstName      String    @db.VarChar(20)
  middleName     String?   @db.VarChar(20)
  firstLastName  String    @db.VarChar(20)
  secondLastName String?   @db.VarChar(20)
  docNumber      String    @unique @db.VarChar(12)
  docType        DocType   @relation(fields: [docTypeId], references: [id])
  docTypeId      Int
  address        Address   @relation(fields: [addressId], references: [id])
  addressId      Int
  regDate        DateTime  @default(now())
  email          String    @unique @db.VarChar(254)
  cellphone      String?   @db.VarChar(24)
  landline       String    @db.VarChar(24)
  student        Student?
  client         Client?
  user           User?
  receipts       Receipt[]
}

model Student {
  id                Int           @id @default(autoincrement())
  person            Person        @relation(fields: [personId], references: [id])
  personId          Int           @unique
  career            Career        @relation(fields: [careerId], references: [id])
  careerId          Int
  status            StudentStatus @relation(fields: [statusId], references: [id])
  statusId          Int
  currentSemester   Int
  enrolledSemesters Enrollment[]
}

model Client {
  id           Int        @id @default(autoincrement())
  occupation   Occupation @relation(fields: [occupationId], references: [id])
  occupationId Int
  person       Person     @relation(fields: [personId], references: [id])
  personId     Int        @unique
}

model Occupation {
  id        Int      @id @default(autoincrement())
  ocupation String   @db.VarChar(40)
  clients   Client[]
}

model StudentStatus {
  id          Int       @id @default(autoincrement())
  status      String    @db.VarChar(30)
  description String    @db.VarChar(64)
  students    Student[]
}

model Enrollment {
  id         Int      @id @default(autoincrement())
  semester   Semester @relation(fields: [semesterId], references: [id])
  semesterId Int
  student    Student  @relation(fields: [studentId], references: [id])
  studentId  Int
}

model Semester {
  id          Int          @id @default(autoincrement())
  startDate   DateTime
  endDate     DateTime
  semester    String       @db.VarChar(30)
  enrollments Enrollment[]
}

model Career {
  id       Int       @id @default(autoincrement())
  career   String    @db.VarChar(40)
  students Student[]
}

model DocType {
  id      Int      @id @default(autoincrement())
  type    String   @db.VarChar(4)
  persons Person[]
}

model Address {
  id           Int      @id @default(autoincrement())
  shortAddress String   @db.VarChar(120)
  persons      Person[]
}

model Receipt {
  id              Int           @id @default(autoincrement())
  person          Person        @relation(fields: [personId], references: [id])
  personId        Int
  charges         Charge[]
  chargedProducts ProductSale[]
  createdAt       DateTime      @default(now())
}

model Product {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(64)
  stock        Int
  price        Decimal
  category     Category      @relation(fields: [categoryId], references: [id])
  categoryId   Int
  productSales ProductSale[]
}

model ProductSale {
  id        Int     @id @default(autoincrement())
  product   Product @relation(fields: [productId], references: [id])
  productId Int
  receipt   Receipt @relation(fields: [receiptId], references: [id])
  receiptId Int
  quantity  Int
}

model Category {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(64)
  description String    @db.VarChar(128)
  products    Product[]
}

model Charge {
  id              Int           @id @default(autoincrement())
  paymentMethod   PaymentMethod @relation(fields: [paymentMethodId], references: [id])
  paymentMethodId Int
  amount          Decimal
  date            DateTime
  receipt         Receipt       @relation(fields: [receiptId], references: [id])
  receiptId       Int
}

model PaymentMethod {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(26)
  description String   @db.VarChar(64)
  currency    Currency @relation(fields: [currencyId], references: [id])
  currencyId  Int
  charges     Charge[]
}

model Currency {
  id             Int             @id @default(autoincrement())
  symbol         String          @db.VarChar(4)
  name           String          @db.VarChar(32)
  paymentMethods PaymentMethod[]
}

model Conversion {
  id    Int      @id @default(autoincrement())
  date  DateTime @default(now())
  dolar Decimal
  euro  Decimal
}

model Parameters {
  id         Int    @id @default(autoincrement())
  institute  String @db.VarChar(128)
  rif        String @db.VarChar(28)
  phone      String @db.VarChar(32)
  population String @db.VarChar(64)
  address    String @db.VarChar(128)
}

model User {
  id       Int        @id @default(autoincrement())
  person   Person     @relation(fields: [personId], references: [id])
  personId Int        @unique
  username String     @db.VarChar(32)
  password String     @db.VarChar()
  secret   Secret     @relation(fields: [secretId], references: [id])
  secretId Int        @unique
  status   UserStatus @relation(fields: [statusId], references: [id])
  statusId Int
  roles    Role[]
}

model Secret {
  id            Int    @id @default(autoincrement())
  user          User?
  questionOne   String @db.VarChar(128)
  answerOne     String @db.VarChar(128)
  questionTwo   String @db.VarChar(128)
  answerTwo     String @db.VarChar(128)
  questionThree String @db.VarChar(128)
  answerThree   String @db.VarChar(128)
}

model UserStatus {
  id          Int    @id @default(autoincrement())
  status      String @db.VarChar(30)
  description String @db.VarChar(64)
  users       User[]
}

model Role {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(30)
  level       Int
  description String       @db.VarChar(64)
  permissions Permission[]
  users       User[]
}

model Permission {
  id          Int    @id @default(autoincrement())
  permission  String @db.VarChar(30)
  description String @db.VarChar(64)
  roles       Role[]
}
